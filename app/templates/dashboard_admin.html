{% extends 'base.html' %}
{% block content %}

<h2 class="fw-bold mb-4 text-center">Admin Dashboard</h2>

<!-- Students Section -->
<div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white fw-bold">
        Registered Students
    </div>

    <div class="card-body">

        {% if students %}
            <ul class="list-group">
                {% for s in students %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span>
                            {{ s.fullname }} ({{ s.email }})
                        </span>

                        <a href="{{ url_for('admin.create_task', student_id=s.id) }}"
                           class="btn btn-sm btn-primary fw-semibold">
                            Assign Task
                        </a>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="text-muted">No students registered yet.</p>
        {% endif %}

    </div>
</div>

<!-- All Tasks Section -->
<div class="card shadow-sm">
    <div class="card-header bg-secondary text-white fw-bold">
        All Tasks
    </div>

    <div class="card-body">

        {% if tasks %}
        <div class="table-responsive">
            <table class="table table-bordered table-striped align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Title</th>
                        <th>Student</th>
                        <th>Due Date</th>
                        <th>Status</th>
                        <th style="width: 180px;">Actions</th>
                    </tr>
                </thead>

                <tbody>
                    {% for t in tasks %}
                    <tr>
                        <td>{{ t.title }}</td>
                        <td>{{ t.student.fullname if t.student else 'N/A' }}</td>
                        <td>{{ t.due_date }}</td>

                        <td>
                            <span class="badge 
                                {% if t.status == 'Completed' %} bg-success
                                {% elif t.status == 'Pending' %} bg-warning text-dark
                                {% else %} bg-secondary
                                {% endif %}
                            ">
                                {{ t.status }}
                            </span>
                        </td>

                        <td>
                            <a href="{{ url_for('admin.view_task', task_id=t.id) }}"
                               class="btn btn-sm btn-info text-white">View</a>

                            <a href="{{ url_for('admin.edit_task', task_id=t.id) }}"
                               class="btn btn-sm btn-warning">Edit</a>

                            <a href="{{ url_for('admin.delete_task', task_id=t.id) }}"
                               class="btn btn-sm btn-danger"
                               onclick="return confirm('Are you sure you want to delete this task?');">
                               Delete
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>

            </table>
        </div>

        {% else %}
            <p class="text-muted">No tasks available yet.</p>
        {% endif %}

    </div>
</div>

{% endblock %}
